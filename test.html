<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokédex Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .pokemon-card {
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .pokemon-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        .type-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: white;
        }
        .progress-bar {
            height: 0.5rem;
            border-radius: 0.25rem;
            background-color: #e5e7eb;
        }
        .progress-fill {
            height: 100%;
            border-radius: 0.25rem;
        }
        .battle-animation {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .team-slot {
            min-height: 100px;
            border: 2px dashed #d1d5db;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        .team-slot:hover {
            border-color: #9ca3af;
        }
        .team-slot.filled {
            border-style: solid;
            border-color: #3b82f6;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-8">
            <div class="flex items-center mb-4 md:mb-0">
                <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/25.png" 
                     alt="Pikachu" class="w-16 h-16 mr-4">
                <h1 class="text-3xl font-bold text-gray-800">Pokédex Pro</h1>
            </div>
            <div class="flex space-x-4">
                <button id="teamBtn" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">
                    <i class="fas fa-users mr-2"></i>My Team
                </button>
                <button id="battlesBtn" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition">
                    <i class="fas fa-trophy mr-2"></i>Battle History
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main>
            <!-- Search and Filters -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0">
                    <div class="relative flex-grow md:mr-4">
                        <input type="text" id="searchInput" placeholder="Search Pokémon by name or ID..." 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
                    </div>
                    <div class="flex space-x-2">
                        <select id="typeFilter" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">All Types</option>
                            <!-- Types will be populated by JavaScript -->
                        </select>
                        <button id="searchBtn" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">
                            Search
                        </button>
                    </div>
                </div>
            </div>

            <!-- Pokémon Grid -->
            <div id="pokemonGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 mb-8">
                <!-- Pokémon cards will be populated by JavaScript -->
                <div class="text-center py-12">
                    <i class="fas fa-spinner fa-spin text-4xl text-gray-400 mb-4"></i>
                    <p class="text-gray-600">Loading Pokémon...</p>
                </div>
            </div>

            <!-- Pagination -->
            <div id="pagination" class="flex justify-center space-x-2 mb-8">
                <!-- Pagination buttons will be populated by JavaScript -->
            </div>

            <!-- Team Modal -->
            <div id="teamModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-800">My Pokémon Team</h2>
                            <button id="closeTeamModal" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times text-2xl"></i>
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
                            <div class="team-slot" data-slot="1">
                                <p class="text-gray-400">Slot 1</p>
                            </div>
                            <div class="team-slot" data-slot="2">
                                <p class="text-gray-400">Slot 2</p>
                            </div>
                            <div class="team-slot" data-slot="3">
                                <p class="text-gray-400">Slot 3</p>
                            </div>
                            <div class="team-slot" data-slot="4">
                                <p class="text-gray-400">Slot 4</p>
                            </div>
                            <div class="team-slot" data-slot="5">
                                <p class="text-gray-400">Slot 5</p>
                            </div>
                            <div class="team-slot" data-slot="6">
                                <p class="text-gray-400">Slot 6</p>
                            </div>
                        </div>
                        
                        <div class="flex justify-end space-x-4">
                            <button id="saveTeamBtn" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition">
                                <i class="fas fa-save mr-2"></i>Save Team
                            </button>
                            <button id="clearTeamBtn" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition">
                                <i class="fas fa-trash mr-2"></i>Clear Team
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Battle Modal -->
            <div id="battleModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-800">Pokémon Battle</h2>
                            <button id="closeBattleModal" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times text-2xl"></i>
                            </button>
                        </div>
                        
                        <div class="flex flex-col md:flex-row justify-around items-center mb-8">
                            <div class="flex flex-col items-center mb-4 md:mb-0">
                                <select id="battlePokemon1" class="px-4 py-2 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <!-- Pokémon options will be populated by JavaScript -->
                                </select>
                                <div id="battlePokemon1Display" class="text-center">
                                    <!-- Selected Pokémon will be displayed here -->
                                </div>
                            </div>
                            
                            <div class="text-center mx-4 my-8">
                                <button id="startBattleBtn" class="px-6 py-3 bg-red-500 text-white rounded-full hover:bg-red-600 transition battle-animation">
                                    <i class="fas fa-bolt mr-2"></i>BATTLE!
                                </button>
                            </div>
                            
                            <div class="flex flex-col items-center mb-4 md:mb-0">
                                <select id="battlePokemon2" class="px-4 py-2 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <!-- Pokémon options will be populated by JavaScript -->
                                </select>
                                <div id="battlePokemon2Display" class="text-center">
                                    <!-- Selected Pokémon will be displayed here -->
                                </div>
                            </div>
                        </div>
                        
                        <div id="battleResult" class="bg-gray-100 rounded-lg p-4 hidden">
                            <!-- Battle results will be displayed here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Battle History Modal -->
            <div id="battlesModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-800">Battle History</h2>
                            <button id="closeBattlesModal" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times text-2xl"></i>
                            </button>
                        </div>
                        
                        <div id="battleHistory" class="space-y-4">
                            <!-- Battle history will be populated by JavaScript -->
                            <div class="text-center py-8">
                                <i class="fas fa-trophy text-4xl text-gray-300 mb-4"></i>
                                <p class="text-gray-500">No battle history yet. Start battling to see results!</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pokémon Details Modal -->
            <div id="pokemonModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 id="pokemonModalTitle" class="text-2xl font-bold text-gray-800">Pokémon Details</h2>
                            <button id="closePokemonModal" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times text-2xl"></i>
                            </button>
                        </div>
                        
                        <div id="pokemonDetails" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Pokémon details will be populated by JavaScript -->
                        </div>
                        
                        <div class="flex justify-end space-x-4 mt-6">
                            <button id="addToTeamBtn" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">
                                <i class="fas fa-plus mr-2"></i>Add to Team
                            </button>
                            <button id="battleThisPokemonBtn" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition">
                                <i class="fas fa-bolt mr-2"></i>Battle This Pokémon
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Global variables
        let currentPage = 1;
        const pokemonPerPage = 20;
        let allPokemon = [];
        let filteredPokemon = [];
        let pokemonTypes = [];
        let currentTeam = [];
        let battleHistory = [];
        
        // DOM elements
        const pokemonGrid = document.getElementById('pokemonGrid');
        const pagination = document.getElementById('pagination');
        const searchInput = document.getElementById('searchInput');
        const typeFilter = document.getElementById('typeFilter');
        const searchBtn = document.getElementById('searchBtn');
        
        // Modal elements
        const teamModal = document.getElementById('teamModal');
        const battleModal = document.getElementById('battleModal');
        const battlesModal = document.getElementById('battlesModal');
        const pokemonModal = document.getElementById('pokemonModal');
        
        // Buttons
        const teamBtn = document.getElementById('teamBtn');
        const battlesBtn = document.getElementById('battlesBtn');
        const closeTeamModal = document.getElementById('closeTeamModal');
        const closeBattleModal = document.getElementById('closeBattleModal');
        const closeBattlesModal = document.getElementById('closeBattlesModal');
        const closePokemonModal = document.getElementById('closePokemonModal');
        const saveTeamBtn = document.getElementById('saveTeamBtn');
        const clearTeamBtn = document.getElementById('clearTeamBtn');
        const startBattleBtn = document.getElementById('startBattleBtn');
        const addToTeamBtn = document.getElementById('addToTeamBtn');
        const battleThisPokemonBtn = document.getElementById('battleThisPokemonBtn');
        
        // JSON Server URL
        const apiUrl = 'http://localhost:3000';
        
        // Type colors mapping
        const typeColors = {
            normal: 'bg-gray-400',
            fire: 'bg-red-500',
            water: 'bg-blue-500',
            electric: 'bg-yellow-400',
            grass: 'bg-green-500',
            ice: 'bg-blue-200',
            fighting: 'bg-red-700',
            poison: 'bg-purple-500',
            ground: 'bg-yellow-600',
            flying: 'bg-indigo-300',
            psychic: 'bg-pink-500',
            bug: 'bg-green-400',
            rock: 'bg-yellow-700',
            ghost: 'bg-purple-700',
            dragon: 'bg-indigo-600',
            dark: 'bg-gray-800',
            steel: 'bg-gray-500',
            fairy: 'bg-pink-300'
        };
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            // Fetch Pokémon data
            fetchPokemonData();
            
            // Fetch Pokémon types
            fetchPokemonTypes();
            
            // Load team and battle history from json-server
            loadTeam();
            loadBattleHistory();
            
            // Set up event listeners
            setupEventListeners();
        });
        
        // Set up event listeners
        function setupEventListeners() {
            // Search and filter
            searchBtn.addEventListener('click', () => {
                currentPage = 1;
                filterPokemon();
                renderPokemonGrid();
                renderPagination();
            });
            
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    currentPage = 1;
                    filterPokemon();
                    renderPokemonGrid();
                    renderPagination();
                }
            });
            
            // Modal buttons
            teamBtn.addEventListener('click', () => {
                teamModal.classList.remove('hidden');
                renderTeamModal();
            });
            
            battlesBtn.addEventListener('click', () => {
                battlesModal.classList.remove('hidden');
                renderBattleHistory();
            });
            
            closeTeamModal.addEventListener('click', () => {
                teamModal.classList.add('hidden');
            });
            
            closeBattleModal.addEventListener('click', () => {
                battleModal.classList.add('hidden');
            });
            
            closeBattlesModal.addEventListener('click', () => {
                battlesModal.classList.add('hidden');
            });
            
            closePokemonModal.addEventListener('click', () => {
                pokemonModal.classList.add('hidden');
            });
            
            // Team management
            saveTeamBtn.addEventListener('click', saveTeam);
            clearTeamBtn.addEventListener('click', clearTeam);
            
            // Battle
            startBattleBtn.addEventListener('click', startBattle);
            addToTeamBtn.addEventListener('click', addToTeam);
            battleThisPokemonBtn.addEventListener('click', battleThisPokemon);
            
            // Team slot clicks
            document.querySelectorAll('.team-slot').forEach(slot => {
                slot.addEventListener('click', () => {
                    const slotNumber = parseInt(slot.dataset.slot);
                    if (currentTeam[slotNumber - 1]) {
                        // Remove Pokémon from this slot
                        currentTeam[slotNumber - 1] = null;
                        renderTeamModal();
                    }
                });
            });
        }
        
        // Fetch Pokémon data from PokeAPI
        async function fetchPokemonData() {
            try {
                const response = await fetch('https://pokeapi.co/api/v2/pokemon?limit=151'); // First 151 Pokémon
                const data = await response.json();
                allPokemon = data.results;
                filteredPokemon = [...allPokemon];
                renderPokemonGrid();
                renderPagination();
            } catch (error) {
                console.error('Error fetching Pokémon data:', error);
                pokemonGrid.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>
                        <p class="text-gray-600">Failed to load Pokémon. Please try again later.</p>
                    </div>
                `;
            }
        }
        
        // Fetch Pokémon types from PokeAPI
        async function fetchPokemonTypes() {
            try {
                const response = await fetch('https://pokeapi.co/api/v2/type');
                const data = await response.json();
                pokemonTypes = data.results.filter(type => type.name !== 'unknown' && type.name !== 'shadow');
                
                // Populate type filter dropdown
                pokemonTypes.forEach(type => {
                    const option = document.createElement('option');
                    option.value = type.name;
                    option.textContent = type.name.charAt(0).toUpperCase() + type.name.slice(1);
                    typeFilter.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching Pokémon types:', error);
            }
        }
        
        // Filter Pokémon based on search and type
        function filterPokemon() {
            const searchTerm = searchInput.value.toLowerCase();
            const selectedType = typeFilter.value;
            
            filteredPokemon = allPokemon.filter(pokemon => {
                const matchesSearch = pokemon.name.includes(searchTerm) || 
                                     pokemon.url.split('/')[6].toString().includes(searchTerm);
                
                if (selectedType === '') {
                    return matchesSearch;
                } else {
                    // In a real app, we'd need to fetch each Pokémon's details to check its types
                    // For this demo, we'll just filter by name and let the type filter be visual only
                    return matchesSearch;
                }
            });
        }
        
        // Render Pokémon grid
        async function renderPokemonGrid() {
            const startIndex = (currentPage - 1) * pokemonPerPage;
            const endIndex = startIndex + pokemonPerPage;
            const pokemonToDisplay = filteredPokemon.slice(startIndex, endIndex);
            
            if (pokemonToDisplay.length === 0) {
                pokemonGrid.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-search text-4xl text-gray-400 mb-4"></i>
                        <p class="text-gray-600">No Pokémon found matching your criteria.</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            for (const pokemon of pokemonToDisplay) {
                const pokemonId = pokemon.url.split('/')[6];
                const pokemonDetails = await fetchPokemonDetails(pokemonId);
                
                html += `
                    <div class="pokemon-card bg-white rounded-lg shadow-md overflow-hidden cursor-pointer transition" data-id="${pokemonId}">
                        <div class="bg-gray-100 p-4 flex justify-center">
                            <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${pokemonId}.png" 
                                 alt="${pokemon.name}" class="w-32 h-32 object-contain">
                        </div>
                        <div class="p-4">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-lg font-semibold text-gray-800 capitalize">${pokemon.name}</h3>
                                <span class="text-gray-500">#${pokemonId.padStart(3, '0')}</span>
                            </div>
                            <div class="flex space-x-2 mb-3">
                                ${pokemonDetails.types.map(type => `
                                    <span class="type-badge ${typeColors[type.type.name]}">${type.type.name}</span>
                                `).join('')}
                            </div>
                            <div class="flex justify-between text-sm text-gray-600">
                                <span><i class="fas fa-weight-hanging mr-1"></i> ${pokemonDetails.weight / 10} kg</span>
                                <span><i class="fas fa-ruler-vertical mr-1"></i> ${pokemonDetails.height / 10} m</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            pokemonGrid.innerHTML = html;
            
            // Add click event to each Pokémon card
            document.querySelectorAll('.pokemon-card').forEach(card => {
                card.addEventListener('click', () => {
                    const pokemonId = card.dataset.id;
                    showPokemonDetails(pokemonId);
                });
            });
        }
        
        // Render pagination
        function renderPagination() {
            const totalPages = Math.ceil(filteredPokemon.length / pokemonPerPage);
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }
            
            let html = '';
            
            // Previous button
            html += `
                <button class="px-3 py-1 rounded-lg border ${currentPage === 1 ? 'bg-gray-200 text-gray-500 cursor-not-allowed' : 'bg-white hover:bg-gray-100'}" 
                        ${currentPage === 1 ? 'disabled' : ''} id="prevPage">
                    <i class="fas fa-chevron-left"></i>
                </button>
            `;
            
            // Page numbers
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            if (startPage > 1) {
                html += `<button class="px-3 py-1 rounded-lg border bg-white hover:bg-gray-100" data-page="1">1</button>`;
                if (startPage > 2) {
                    html += `<span class="px-2">...</span>`;
                }
            }
            
            for (let i = startPage; i <= endPage; i++) {
                html += `
                    <button class="px-3 py-1 rounded-lg border ${currentPage === i ? 'bg-blue-500 text-white' : 'bg-white hover:bg-gray-100'}" 
                            data-page="${i}">${i}</button>
                `;
            }
            
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    html += `<span class="px-2">...</span>`;
                }
                html += `<button class="px-3 py-1 rounded-lg border bg-white hover:bg-gray-100" data-page="${totalPages}">${totalPages}</button>`;
            }
            
            // Next button
            html += `
                <button class="px-3 py-1 rounded-lg border ${currentPage === totalPages ? 'bg-gray-200 text-gray-500 cursor-not-allowed' : 'bg-white hover:bg-gray-100'}" 
                        ${currentPage === totalPages ? 'disabled' : ''} id="nextPage">
                    <i class="fas fa-chevron-right"></i>
                </button>
            `;
            
            pagination.innerHTML = html;
            
            // Add event listeners to pagination buttons
            document.getElementById('prevPage')?.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderPokemonGrid();
                    renderPagination();
                }
            });
            
            document.getElementById('nextPage')?.addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    renderPokemonGrid();
                    renderPagination();
                }
            });
            
            document.querySelectorAll('[data-page]').forEach(button => {
                button.addEventListener('click', () => {
                    currentPage = parseInt(button.dataset.page);
                    renderPokemonGrid();
                    renderPagination();
                });
            });
        }
        
        // Fetch detailed Pokémon data
        async function fetchPokemonDetails(pokemonId) {
            try {
                const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${pokemonId}`);
                return await response.json();
            } catch (error) {
                console.error(`Error fetching details for Pokémon #${pokemonId}:`, error);
                return null;
            }
        }
        
        // Show Pokémon details modal
        async function showPokemonDetails(pokemonId) {
            const pokemonDetails = await fetchPokemonDetails(pokemonId);
            
            if (!pokemonDetails) {
                alert('Failed to load Pokémon details. Please try again.');
                return;
            }
            
            // Set modal title
            document.getElementById('pokemonModalTitle').textContent = 
                `${pokemonDetails.name.charAt(0).toUpperCase() + pokemonDetails.name.slice(1)} #${pokemonDetails.id.toString().padStart(3, '0')}`;
            
            // Prepare stats HTML
            const statsHtml = pokemonDetails.stats.map(stat => `
                <div class="mb-2">
                    <div class="flex justify-between text-sm mb-1">
                        <span class="font-medium capitalize">${stat.stat.name.replace('-', ' ')}</span>
                        <span>${stat.base_stat}/255</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill bg-blue-500" style="width: ${(stat.base_stat / 255) * 100}%"></div>
                    </div>
                </div>
            `).join('');
            
            // Prepare abilities HTML
            const abilitiesHtml = pokemonDetails.abilities.map(ability => `
                <li class="capitalize">${ability.ability.name.replace('-', ' ')}${ability.is_hidden ? ' (hidden)' : ''}</li>
            `).join('');
            
            // Prepare moves HTML (showing only first 5 moves)
            const movesHtml = pokemonDetails.moves.slice(0, 5).map(move => `
                <li class="capitalize">${move.move.name.replace('-', ' ')}</li>
            `).join('');
            
            // Set Pokémon details content
            document.getElementById('pokemonDetails').innerHTML = `
                <div>
                    <div class="bg-gray-100 rounded-lg p-4 flex justify-center mb-4">
                        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${pokemonDetails.id}.png" 
                             alt="${pokemonDetails.name}" class="w-48 h-48 object-contain">
                    </div>
                    <div class="flex justify-center space-x-3 mb-4">
                        ${pokemonDetails.types.map(type => `
                            <span class="type-badge ${typeColors[type.type.name]}">${type.type.name}</span>
                        `).join('')}
                    </div>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div class="bg-gray-100 rounded-lg p-3 text-center">
                            <p class="text-sm text-gray-500">Weight</p>
                            <p class="font-medium">${pokemonDetails.weight / 10} kg</p>
                        </div>
                        <div class="bg-gray-100 rounded-lg p-3 text-center">
                            <p class="text-sm text-gray-500">Height</p>
                            <p class="font-medium">${pokemonDetails.height / 10} m</p>
                        </div>
                    </div>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-3">Stats</h3>
                    ${statsHtml}
                    
                    <h3 class="text-lg font-semibold mt-6 mb-3">Abilities</h3>
                    <ul class="list-disc list-inside space-y-1">
                        ${abilitiesHtml}
                    </ul>
                    
                    <h3 class="text-lg font-semibold mt-6 mb-3">Sample Moves</h3>
                    <ul class="list-disc list-inside space-y-1">
                        ${movesHtml}
                        ${pokemonDetails.moves.length > 5 ? '<li>...and ' + (pokemonDetails.moves.length - 5) + ' more</li>' : ''}
                    </ul>
                </div>
            `;
            
            // Set data attribute for the add to team button
            addToTeamBtn.dataset.pokemonId = pokemonDetails.id;
            battleThisPokemonBtn.dataset.pokemonId = pokemonDetails.id;
            
            // Show the modal
            pokemonModal.classList.remove('hidden');
        }
        
        // Load team from json-server
        async function loadTeam() {
            try {
                const response = await fetch(`${apiUrl}/team`);
                if (response.ok) {
                    const data = await response.json();
                    if (data.length > 0) {
                        currentTeam = data[0].pokemon;
                    } else {
                        currentTeam = Array(6).fill(null);
                    }
                } else {
                    currentTeam = Array(6).fill(null);
                }
            } catch (error) {
                console.error('Error loading team:', error);
                currentTeam = Array(6).fill(null);
            }
        }
        
        // Save team to json-server
        async function saveTeam() {
            try {
                // Check if team is empty
                if (currentTeam.every(slot => slot === null)) {
                    alert('Your team is empty. Add some Pokémon first!');
                    return;
                }
                
                // First check if we already have a team record
                const checkResponse = await fetch(`${apiUrl}/team`);
                let teamId = 1;
                
                if (checkResponse.ok) {
                    const data = await checkResponse.json();
                    if (data.length > 0) {
                        teamId = data[0].id;
                    }
                }
                
                // Save or update the team
                const response = await fetch(`${apiUrl}/team/${teamId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        id: teamId,
                        pokemon: currentTeam,
                        updatedAt: new Date().toISOString()
                    })
                });
                
                if (response.ok) {
                    alert('Team saved successfully!');
                } else {
                    alert('Failed to save team. Please try again.');
                }
            } catch (error) {
                console.error('Error saving team:', error);
                alert('Failed to save team. Please check your json-server connection.');
            }
        }
        
        // Clear team
        function clearTeam() {
            if (confirm('Are you sure you want to clear your team?')) {
                currentTeam = Array(6).fill(null);
                renderTeamModal();
            }
        }
        
        // Add Pokémon to team
        function addToTeam() {
            const pokemonId = parseInt(addToTeamBtn.dataset.pokemonId);
            
            // Find first empty slot
            const emptySlotIndex = currentTeam.findIndex(slot => slot === null);
            
            if (emptySlotIndex === -1) {
                alert('Your team is full! Remove a Pokémon first.');
                return;
            }
            
            // Check if this Pokémon is already in the team
            if (currentTeam.some(slot => slot?.id === pokemonId)) {
                alert('This Pokémon is already in your team!');
                return;
            }
            
            // Add to team
            currentTeam[emptySlotIndex] = { id: pokemonId };
            renderTeamModal();
            
            // Show success message
            const successMsg = document.createElement('div');
            successMsg.className = 'fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg';
            successMsg.innerHTML = '<i class="fas fa-check-circle mr-2"></i> Pokémon added to team!';
            document.body.appendChild(successMsg);
            
            setTimeout(() => {
                successMsg.remove();
            }, 3000);
        }
        
        // Render team modal
        async function renderTeamModal() {
            const teamSlots = document.querySelectorAll('.team-slot');
            
            for (let i = 0; i < teamSlots.length; i++) {
                const slot = teamSlots[i];
                const pokemon = currentTeam[i];
                
                if (pokemon) {
                    const pokemonDetails = await fetchPokemonDetails(pokemon.id);
                    
                    slot.innerHTML = `
                        <div class="text-center">
                            <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${pokemonDetails.id}.png" 
                                 alt="${pokemonDetails.name}" class="w-16 h-16 mx-auto mb-2">
                            <h4 class="font-medium capitalize">${pokemonDetails.name}</h4>
                            <div class="flex justify-center space-x-1 mt-1">
                                ${pokemonDetails.types.map(type => `
                                    <span class="type-badge ${typeColors[type.type.name]} text-xs">${type.type.name}</span>
                                `).join('')}
                            </div>
                            <button class="mt-2 text-red-500 hover:text-red-700 text-sm">
                                <i class="fas fa-times mr-1"></i>Remove
                            </button>
                        </div>
                    `;
                    slot.classList.add('filled');
                } else {
                    slot.innerHTML = `<p class="text-gray-400">Slot ${i + 1}</p>`;
                    slot.classList.remove('filled');
                }
            }
            
            // Render battle select options
            renderBattleSelectOptions();
        }
        
        // Load battle history from json-server
        async function loadBattleHistory() {
            try {
                const response = await fetch(`${apiUrl}/battles`);
                if (response.ok) {
                    battleHistory = await response.json();
                } else {
                    battleHistory = [];
                }
            } catch (error) {
                console.error('Error loading battle history:', error);
                battleHistory = [];
            }
        }
        
        // Render battle history
        function renderBattleHistory() {
            const battleHistoryContainer = document.getElementById('battleHistory');
            
            if (battleHistory.length === 0) {
                battleHistoryContainer.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-trophy text-4xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500">No battle history yet. Start battling to see results!</p>
                    </div>
                `;
                return;
            }
            
            // Sort by most recent
            const sortedHistory = [...battleHistory].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            battleHistoryContainer.innerHTML = sortedHistory.map(battle => `
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="font-medium">Battle #${battle.id}</h3>
                        <span class="text-sm text-gray-500">${new Date(battle.date).toLocaleString()}</span>
                    </div>
                    <div class="flex items-center justify-around my-4">
                        <div class="text-center">
                            <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${battle.pokemon1.id}.png" 
                                 alt="${battle.pokemon1.name}" class="w-16 h-16 mx-auto">
                            <p class="capitalize mt-1">${battle.pokemon1.name}</p>
                        </div>
                        <div class="mx-4 text-center">
                            <span class="text-xl font-bold">VS</span>
                        </div>
                        <div class="text-center">
                            <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${battle.pokemon2.id}.png" 
                                 alt="${battle.pokemon2.name}" class="w-16 h-16 mx-auto">
                            <p class="capitalize mt-1">${battle.pokemon2.name}</p>
                        </div>
                    </div>
                    <div class="text-center mt-4">
                        <span class="px-3 py-1 rounded-full ${battle.winner === 'pokemon1' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            Winner: <span class="font-bold capitalize">${battle.winner === 'pokemon1' ? battle.pokemon1.name : battle.pokemon2.name}</span>
                        </span>
                    </div>
                </div>
            `).join('');
        }
        
        // Battle this Pokémon (from details modal)
        function battleThisPokemon() {
            const pokemonId = parseInt(battleThisPokemonBtn.dataset.pokemonId);
            
            // Set this Pokémon as the first in battle
            document.getElementById('battlePokemon1').value = pokemonId;
            updateBattlePokemonDisplay('battlePokemon1', pokemonId);
            
            // Show battle modal
            battleModal.classList.remove('hidden');
        }
        
        // Render battle select options
        async function renderBattleSelectOptions() {
            const select1 = document.getElementById('battlePokemon1');
            const select2 = document.getElementById('battlePokemon2');
            
            // Clear existing options except the first default one
            while (select1.options.length > 1) select1.remove(1);
            while (select2.options.length > 1) select2.remove(1);
            
            // Add team Pokémon to select options
            for (const pokemon of currentTeam) {
                if (pokemon) {
                    const pokemonDetails = await fetchPokemonDetails(pokemon.id);
                    
                    const option1 = document.createElement('option');
                    option1.value = pokemon.id;
                    option1.textContent = `#${pokemon.id} ${pokemonDetails.name.charAt(0).toUpperCase() + pokemonDetails.name.slice(1)}`;
                    select1.appendChild(option1.cloneNode(true));
                    
                    const option2 = option1.cloneNode(true);
                    select2.appendChild(option2);
                }
            }
            
            // Add event listeners to selects
            select1.addEventListener('change', async (e) => {
                const pokemonId = parseInt(e.target.value);
                updateBattlePokemonDisplay('battlePokemon1', pokemonId);
            });
            
            select2.addEventListener('change', async (e) => {
                const pokemonId = parseInt(e.target.value);
                updateBattlePokemonDisplay('battlePokemon2', pokemonId);
            });
        }
        
        // Update battle Pokémon display
        async function updateBattlePokemonDisplay(prefix, pokemonId) {
            const displayDiv = document.getElementById(`${prefix}Display`);
            
            if (isNaN(pokemonId)) {
                displayDiv.innerHTML = '<p class="text-gray-500">Select a Pokémon</p>';
                return;
            }
            
            const pokemonDetails = await fetchPokemonDetails(pokemonId);
            
            displayDiv.innerHTML = `
                <div class="bg-gray-100 rounded-lg p-4">
                    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${pokemonDetails.id}.png" 
                         alt="${pokemonDetails.name}" class="w-32 h-32 mx-auto">
                    <h3 class="text-lg font-semibold text-center capitalize mt-2">${pokemonDetails.name}</h3>
                    <div class="flex justify-center space-x-2 mt-2">
                        ${pokemonDetails.types.map(type => `
                            <span class="type-badge ${typeColors[type.type.name]}">${type.type.name}</span>
                        `).join('')}
                    </div>
                    <div class="mt-3">
                        <div class="flex justify-between text-sm">
                            <span>HP</span>
                            <span>${pokemonDetails.stats[0].base_stat}</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span>Attack</span>
                            <span>${pokemonDetails.stats[1].base_stat}</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span>Defense</span>
                            <span>${pokemonDetails.stats[2].base_stat}</span>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Start battle
        async function startBattle() {
            const pokemon1Id = parseInt(document.getElementById('battlePokemon1').value);
            const pokemon2Id = parseInt(document.getElementById('battlePokemon2').value);
            
            if (isNaN(pokemon1Id) || isNaN(pokemon2Id)) {
                alert('Please select two Pokémon to battle!');
                return;
            }
            
            if (pokemon1Id === pokemon2Id) {
                alert('A Pokémon cannot battle itself!');
                return;
            }
            
            const pokemon1 = await fetchPokemonDetails(pokemon1Id);
            const pokemon2 = await fetchPokemonDetails(pokemon2Id);
            
            // Simple battle algorithm based on stats
            const pokemon1Score = calculateBattleScore(pokemon1);
            const pokemon2Score = calculateBattleScore(pokemon2);
            
            let winner;
            if (pokemon1Score > pokemon2Score) {
                winner = 'pokemon1';
            } else if (pokemon2Score > pokemon1Score) {
                winner = 'pokemon2';
            } else {
                // Tie - randomly pick a winner
                winner = Math.random() > 0.5 ? 'pokemon1' : 'pokemon2';
            }
            
            // Display battle result
            const battleResultDiv = document.getElementById('battleResult');
            battleResultDiv.innerHTML = `
                <div class="text-center">
                    <h3 class="text-xl font-bold mb-4">Battle Result</h3>
                    <div class="flex items-center justify-center mb-4">
                        <div class="text-center px-4">
                            <p class="text-lg font-medium capitalize">${pokemon1.name}</p>
                            <p class="text-2xl font-bold ${winner === 'pokemon1' ? 'text-green-600' : 'text-red-600'}">
                                ${pokemon1Score}
                            </p>
                        </div>
                        <div class="text-4xl font-bold mx-4">VS</div>
                        <div class="text-center px-4">
                            <p class="text-lg font-medium capitalize">${pokemon2.name}</p>
                            <p class="text-2xl font-bold ${winner === 'pokemon2' ? 'text-green-600' : 'text-red-600'}">
                                ${pokemon2Score}
                            </p>
                        </div>
                    </div>
                    <div class="bg-${winner === 'pokemon1' ? 'green' : 'red'}-100 text-${winner === 'pokemon1' ? 'green' : 'red'}-800 px-4 py-2 rounded-lg inline-block">
                        <i class="fas fa-trophy mr-2"></i>
                        <span class="font-bold capitalize">${winner === 'pokemon1' ? pokemon1.name : pokemon2.name}</span> wins!
                    </div>
                </div>
            `;
            battleResultDiv.classList.remove('hidden');
            
            // Save battle to history
            await saveBattleToHistory(pokemon1, pokemon2, winner);
        }
        
        // Calculate battle score (simple algorithm)
        function calculateBattleScore(pokemon) {
            // Weight stats differently
            return pokemon.stats[0].base_stat * 0.3 +  // HP
                   pokemon.stats[1].base_stat * 0.25 + // Attack
                   pokemon.stats[2].base_stat * 0.25 + // Defense
                   pokemon.stats[5].base_stat * 0.2;   // Speed
        }
        
        // Save battle to history in json-server
        async function saveBattleToHistory(pokemon1, pokemon2, winner) {
            try {
                const response = await fetch(`${apiUrl}/battles`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        pokemon1: {
                            id: pokemon1.id,
                            name: pokemon1.name
                        },
                        pokemon2: {
                            id: pokemon2.id,
                            name: pokemon2.name
                        },
                        winner: winner,
                        date: new Date().toISOString()
                    })
                });
                
                if (response.ok) {
                    // Reload battle history
                    await loadBattleHistory();
                } else {
                    console.error('Failed to save battle history');
                }
            } catch (error) {
                console.error('Error saving battle history:', error);
            }
        }
    </script>
</body>
</html>